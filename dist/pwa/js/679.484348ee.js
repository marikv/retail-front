"use strict";(self["webpackChunkretail_creditbox_md"]=self["webpackChunkretail_creditbox_md"]||[]).push([[679],{7679:(e,a,l)=>{l.r(a),l.d(a,{default:()=>se});var t=l(3673),o=l(8880),n=l(2323);const d=(0,t.Uk)("Caută"),i=(0,t.Uk)("Adaugă"),s=(0,t.Uk)("Redactează"),m=(0,t.Uk)("Șterge");function u(e,a,l,u,r,c){const p=(0,t.up)("q-input"),g=(0,t.up)("q-icon"),y=(0,t.up)("q-tooltip"),f=(0,t.up)("q-btn"),b=(0,t.up)("q-td"),v=(0,t.up)("q-img"),_=(0,t.up)("q-avatar"),w=(0,t.up)("q-table"),h=(0,t.up)("Payment"),q=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(q,{class:"flex flex-block"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{class:"full-width sticky-header-table",flat:!0,title:"Payments",rows:e.rows,columns:e.columns,"row-key":"id",pagination:e.pagination,"onUpdate:pagination":a[3]||(a[3]=a=>e.pagination=a),loading:e.loading,filter:e.filter,"binary-state-sort":"","no-data-label":"Nu sunt înregistrări","rows-per-page-label":"Înregistrări pe pagină","rows-per-page-options":[30,50,100,200,500,1e3,0],onRequest:e.onRequest},{"top-right":(0,t.w5)((()=>[(0,t.Wm)(p,{outlined:"","bg-color":"white",dense:"",debounce:"300",modelValue:e.contractNumber,"onUpdate:modelValue":a[0]||(a[0]=a=>e.contractNumber=a),onKeyup:(0,o.D2)(e.onRequest,["enter"]),class:"q-mr-xs",label:"Nr contract"},null,8,["modelValue","onKeyup"]),(0,t.Wm)(p,{outlined:"","bg-color":"white",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":a[1]||(a[1]=a=>e.filter=a),onKeyup:(0,o.D2)(e.onRequest,["enter"]),placeholder:"Caută"},{append:(0,t.w5)((()=>[(0,t.Wm)(g,{name:"search"})])),_:1},8,["modelValue","onKeyup"]),(0,t.Wm)(f,{icon:"search",round:"",onClick:e.onRequestWithLast,class:"q-ml-lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[d])),_:1})])),_:1},8,["onClick"]),(0,t.Wm)(f,{icon:"add",round:"",onClick:a[2]||(a[2]=a=>e.showPaymentModalSetValue(!0)),class:"q-ml-lg",color:"positive"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[i])),_:1})])),_:1})])),"body-cell-actions":(0,t.w5)((a=>[(0,t.Wm)(b,{props:a,class:"actions-td"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{dense:"",round:"",flat:"",size:"sm",color:"positive",onClick:l=>e.editRow(a),icon:"edit"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[s])),_:1})])),_:2},1032,["onClick"]),(0,t.Wm)(f,{dense:"",round:"",flat:"",size:"sm",color:"negative",onClick:l=>e.deleteRow(a),icon:"delete"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[m])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),"body-cell-dealer_name":(0,t.w5)((a=>[(0,t.Wm)(b,{props:a,class:"props-td"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{style:{border:"1px solid #dddddd"}},{default:(0,t.w5)((()=>[e.getAvatar(a.row.logo)?((0,t.wg)(),(0,t.j4)(v,{key:0,src:e.getAvatar(a.row.logo),alt:""},null,8,["src"])):((0,t.wg)(),(0,t.iD)("div",{key:1,style:(0,n.j5)(`color: ${e.getColorForLogo(a.row.dealer_name)}`)},(0,n.zw)(e.getInitialsForLogo(a.row.dealer_name)),5))])),_:2},1024),(0,t.Uk)(" "+(0,n.zw)(a.row.dealer_name),1)])),_:2},1032,["props"])])),_:1},8,["rows","columns","pagination","loading","filter","onRequest"]),(0,t.Wm)(h,{ref:"PaymentRef",onOnCloseDialog:a[4]||(a[4]=a=>e.showPaymentModalSetValue(!1))},null,512)])),_:1})}l(5363);var r=l(1959),c=l(3617),p=l(5474),g=l(3413);const y={class:"text-subtitle1"},f=(0,t._)("span",{class:"text-blue-grey"},"Payment",-1),b={class:(0,n.C_)("q-ml-md")};function v(e,a,l,o,d,i){const s=(0,t.up)("q-toolbar-title"),m=(0,t.up)("header-tabs-for-forms"),u=(0,t.up)("q-space"),r=(0,t.up)("q-btn"),c=(0,t.up)("q-toolbar"),p=(0,t.up)("q-separator"),g=(0,t.up)("PaymentGeneral"),v=(0,t.up)("q-tab-panel"),_=(0,t.up)("q-tab-panels"),w=(0,t.up)("q-card-section"),h=(0,t.up)("q-card-actions"),q=(0,t.up)("q-card"),k=(0,t.up)("q-dialog");return(0,t.wg)(),(0,t.j4)(k,{ref:"dialogRef",modelValue:o.isOpenedLocal,"onUpdate:modelValue":a[2]||(a[2]=e=>o.isOpenedLocal=e),onHide:o.onDialogHide,"full-height":"",persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{class:"q-dialog-plugin",style:{width:"100%","max-width":"800px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{class:(0,n.C_)("q-pr-xs")},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("span",y,[f,(0,t._)("strong",b,(0,n.zw)(o.id),1)])])),_:1}),(0,t.Wm)(m,{modelValue:o.tab,"onUpdate:modelValue":a[0]||(a[0]=e=>o.tab=e),tabs:o.tabs},null,8,["modelValue","tabs"]),(0,t.Wm)(u),(0,t.Wm)(r,{icon:"close",flat:"",round:"",dense:"",onClick:o.onCancelClick},null,8,["onClick"])])),_:1}),(0,t.Wm)(p),(0,t.Wm)(w,{style:{"min-height":"calc(100vh - 165px)","max-height":"calc(100vh - 165px)"},class:"scroll"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{modelValue:o.tab,"onUpdate:modelValue":a[1]||(a[1]=e=>o.tab=e),animated:"","keep-alive":""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"general",class:"q-pa-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{ref:"PaymentGeneralRef"},null,512)])),_:1})])),_:1},8,["modelValue"])])),_:1}),"general"===o.tab?((0,t.wg)(),(0,t.j4)(p,{key:0})):(0,t.kq)("",!0),"general"===o.tab?((0,t.wg)(),(0,t.j4)(h,{key:1,align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"primary",label:"Salvează",onClick:o.onOKClick},null,8,["onClick"]),(0,t.Wm)(r,{label:"Închide",onClick:o.onCancelClick},null,8,["onClick"])])),_:1})):(0,t.kq)("",!0)])),_:1})])),_:1},8,["modelValue","onHide"])}l(71);var _=l(1701),w=l(7755);const h={class:"row"},q={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},k={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},x={class:"col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12 q-pa-xs"},C={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},Z={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},P={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},V={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"};function W(e,a,l,o,d,i){const s=(0,t.up)("q-input"),m=(0,t.up)("q-img"),u=(0,t.up)("q-avatar");return(0,t.wg)(),(0,t.iD)("div",h,[(0,t._)("div",q,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.clientName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.clientName=a),label:"Nume Prenume client"},null,8,["modelValue"])]),(0,t._)("div",k,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.phone1,"onUpdate:modelValue":a[1]||(a[1]=a=>e.phone1=a),label:"Telefon 1"},null,8,["modelValue"])]),(0,t._)("div",x,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.dealerName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dealerName=a),label:"Dealer"},{prepend:(0,t.w5)((()=>[(0,t.Wm)(u,{style:{border:"1px solid #dddddd"}},{default:(0,t.w5)((()=>[e.getAvatar(e.logo)?((0,t.wg)(),(0,t.j4)(m,{key:0,src:e.getAvatar(e.logo),alt:""},null,8,["src"])):((0,t.wg)(),(0,t.iD)("div",{key:1,style:(0,n.j5)(`color: ${e.getColorForLogo(e.dealerName)}`)},(0,n.zw)(e.getInitialsForLogo(e.dealerName)),5))])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",C,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.paymentSum,"onUpdate:modelValue":a[3]||(a[3]=a=>e.paymentSum=a),label:"Suma rată"},null,8,["modelValue"])]),(0,t._)("div",Z,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.paymentSumFact,"onUpdate:modelValue":a[4]||(a[4]=a=>e.paymentSumFact=a),label:"Suma facto"},null,8,["modelValue"])]),(0,t._)("div",P,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.dateTime,"onUpdate:modelValue":a[5]||(a[5]=a=>e.dateTime=a),label:"Data așteptată"},null,8,["modelValue"])]),(0,t._)("div",V,[(0,t.Wm)(s,{outlined:"",readonly:"",modelValue:e.dateTimeFact,"onUpdate:modelValue":a[6]||(a[6]=a=>e.dateTimeFact=a),label:"Data facto"},null,8,["modelValue"])])])}l(246);const D=(0,t.aZ)({name:"PaymentGeneral",components:{},setup(){const e=(0,c.oR)(),a=(0,r.iH)(""),l=(0,r.iH)(""),o=(0,r.iH)(""),n=(0,r.iH)(""),d=(0,r.iH)(0),i=(0,r.iH)({}),s=(0,r.iH)(""),m=(0,r.iH)(0),u=(0,r.iH)(null),y=(0,r.iH)(null),f=(0,r.iH)(null),b=e=>{if(e){const a=(0,g.LO)(e),l=String(p.api.defaults.baseURL);return`${l.replace("/api","")}/${a}`}return""},v=e=>(0,g.Qm)(e),_=e=>(0,g.Zx)(e);(0,t.m0)((()=>{i.value=e.getters["payments/getOpenedPaymentData"]})),(0,t.m0)((()=>{d.value=i.value.id||0,a.value=i.value.client_last_name?`${i.value.client_last_name} ${i.value.client_first_name}`:"",s.value=i.value.logo||"",l.value=i.value.dealer_name||"",o.value=i.value.phone1||"",n.value=i.value.description||"",m.value=i.value.payment_sum||0,u.value=i.value.payment_sum_fact||null,y.value=i.value.date_time?(0,g.XZ)(i.value.date_time):"",f.value=i.value.date_time_fact?(0,g.$M)(i.value.date_time_fact):null}));const w=()=>{if(m.value){const a={phone1:o.value,description:n.value};(0,g.QP)();const l=parseInt(String(d.value),10);p.api.post(`/payment-add-or-edit/${l}`,a).then((a=>{(0,g.Zk)(),a.data.success?(l>0?(e.commit("payments/updateOpenedPaymentData",{}),e.commit("payments/updateOpenedPaymentForm",!1)):(e.commit("payments/updateOpenedPaymentData",a.data.data),e.commit("payments/updateOpenedPaymentForm",!0)),e.commit("payments/updateRefreshGrid",!0)):(0,g.NU)({message:"Eroare de update"})})).catch((e=>{(0,g.Zk)(),(0,g.NU)({},e)}))}};return{id:d,logo:s,clientName:a,phone1:o,save:w,paymentSumFact:u,paymentSum:m,dateTimeFact:f,dateTime:y,dealerName:l,getAvatar:b,getColorForLogo:_,getInitialsForLogo:v}}});var H=l(4260),R=l(4842),Q=l(5096),U=l(4027),N=l(7518),F=l.n(N);const O=(0,H.Z)(D,[["render",W]]),S=O;F()(D,"components",{QInput:R.Z,QAvatar:Q.Z,QImg:U.Z});const L={name:"Payment",components:{PaymentGeneral:S,HeaderTabsForForms:w.Z},props:{},emits:[..._.Z.emits,"onCloseDialog"],setup(e,a){const l=(0,r.iH)(!1),o=(0,r.iH)(null),n=(0,r.iH)([{name:"general",icon:"store",label:"Date generale"},{name:"files",icon:"folder_open",label:"Fișiere"},{name:"logs",icon:"history",label:"Log"}]),d=(0,r.iH)("general"),i=(0,r.iH)(0),s=(0,c.oR)(),m=(0,r.iH)({}),{dialogRef:u,onDialogHide:y,onDialogCancel:f}=(0,_.Z)();(0,t.m0)((()=>{l.value=s.getters["payments/getOpenedPaymentForm"]})),(0,t.m0)((()=>{m.value=s.getters["payments/getOpenedPaymentData"]})),(0,t.m0)((()=>{i.value=m.value.id}));const b=(e=null)=>{const a={...s.getters["payments/getOpenedPaymentData"]};a.id=e,s.commit("payments/updateOpenedPaymentData",a),(0,g.QP)(),p.api.get(`/payments/get-data-by-id/${e}`).then((e=>{(0,g.Zk)(),e.data.success?s.commit("payments/updateOpenedPaymentData",e.data.data):(0,g.NU)({message:e.data.data.message})})).catch((e=>{(0,g.Zk)(),(0,g.NU)({},e)}))},v=()=>{a.emit("onCloseDialog",!1),y()},w=()=>{"undefined"!==typeof o.value&&"undefined"!==typeof o.value.save&&o.value.save()};return{dialogRef:u,onDialogHide:v,onOKClick:w,onCancelClick:f,isOpenedLocal:l,id:i,tab:d,tabs:n,PaymentGeneralRef:o,getDataById:b}}};var T=l(6778),$=l(151),A=l(9570),I=l(3747),z=l(2025),j=l(2165),G=l(5869),B=l(5589),K=l(5906),M=l(6602),X=l(9367);const E=(0,H.Z)(L,[["render",v]]),J=E;F()(L,"components",{QDialog:T.Z,QCard:$.Z,QToolbar:A.Z,QToolbarTitle:I.Z,QSpace:z.Z,QBtn:j.Z,QSeparator:G.Z,QCardSection:B.Z,QTabPanels:K.Z,QTabPanel:M.Z,QCardActions:X.Z});var Y=l(8825);const ee=[{name:"id",label:"ID",field:"id",sortable:!0,style:"width: 50px"},{name:"bid_id",label:"Contract",field:"bid_id",sortable:!0,align:"center",style:"width: 50px"},{name:"dealer_name",label:"Dealer",field:"dealer_name",sortable:!0,align:"center",style:"width: 50px"},{name:"date_time",label:"Data așteptată",field:"date_time",sortable:!0,align:"center",style:"width: 80px",format:e=>e?(0,g.XZ)(e):""},{name:"date_time_fact",label:"Data facto",field:"date_time_fact",sortable:!0,align:"center",style:"width: 80px",format:e=>e?(0,g.$M)(e):""},{name:"beznal",label:"Banca/Numerar",field:"beznal",sortable:!0,align:"left",format:e=>e?"Banca":"Numerar"},{name:"payment_sum",label:"Suma rata",field:"payment_sum",sortable:!0,align:"left"},{name:"payment_sum_fact",label:"Suma facto",field:"payment_sum_fact",sortable:!0,align:"left"},{name:"client_last_name",label:"Client",field:"client_last_name",sortable:!0,align:"left",format:(e,a)=>e?`${a.client_last_name} ${a.client_first_name}`:""},{name:"created_at2",label:"Adăugat",field:"created_at2",sortable:!0},{name:"actions",label:"",align:"center",style:"width: 60px"}],ae=(0,t.aZ)({name:"Payments",components:{Payment:J},setup(){const e=(0,Y.Z)(),a=(0,r.iH)([]),l=(0,r.iH)(null),o=(0,r.iH)(""),n=(0,r.iH)(null),d=(0,r.iH)(!1),i=(0,c.oR)(),s=(0,r.iH)(null);i.commit("auth/updateActiveModule","Payments");const m=(0,r.iH)({sortBy:"id",descending:!0,page:1,rowsPerPage:30}),u=e=>{if(e){const a=(0,g.LO)(e),l=String(p.api.defaults.baseURL);return`${l.replace("/api","")}/${a}`}return""},y=e=>(0,g.Qm)(e),f=e=>(0,g.Zx)(e),b=e=>{d.value=!0,s.value=e,i.commit("payments/updateRefreshGrid",!1),p.api.post("/payments-list",{...e,contractNumber:n.value}).then((e=>{d.value=!1,e.data.success&&(a.value=e.data.data.data,m.value.page=e.data.data.current_page,m.value.rowsPerPage=e.data.data.per_page,m.value.rowsNumber=e.data.data.total)})).catch((e=>{d.value=!1,(0,g.NU)({},e)}))},v=(e,a=0)=>{i.commit("payments/updateOpenedPaymentForm",e),i.commit("payments/updateOpenedPaymentData",{}),e&&a>0&&l.value&&l.value.getDataById(a)},_=e=>{v(!0,e.row.id)},w=a=>{e.dialog({title:"Atenție",message:"Sunteți sigur că doriți să ștergeți?",cancel:!0,persistent:!0}).onOk((()=>{p.api["delete"](`/payments/${a.row.id}`).then((()=>{b(s.value)}))}))},h=()=>{b(s.value)};return(0,t.m0)((()=>{i.getters["payments/getRefreshGrid"]&&b(s.value)})),(0,t.bv)((()=>{b({pagination:m.value,filter:void 0})})),{filter:o,loading:d,pagination:m,columns:ee,rows:a,showPaymentModalSetValue:v,editRow:_,deleteRow:w,onRequest:b,contractNumber:n,PaymentRef:l,getAvatar:u,getColorForLogo:f,getInitialsForLogo:y,onRequestWithLast:h}}});var le=l(4379),te=l(8107),oe=l(4554),ne=l(8870),de=l(3884);const ie=(0,H.Z)(ae,[["render",u]]),se=ie;F()(ae,"components",{QPage:le.Z,QTable:te.Z,QInput:R.Z,QIcon:oe.Z,QBtn:j.Z,QTooltip:ne.Z,QTd:de.Z,QAvatar:Q.Z,QImg:U.Z})}}]);