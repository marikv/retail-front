"use strict";(self["webpackChunkretail_creditbox_md"]=self["webpackChunkretail_creditbox_md"]||[]).push([[628],{4628:(e,a,l)=>{l.r(a),l.d(a,{default:()=>me});var o=l(3673),t=l(8880),r=l(2323);const s=(0,o.Uk)("Caută"),n=(0,o.Uk)("Adaugă"),i=(0,o.Uk)("Redactează"),u=(0,o.Uk)("Șterge"),d=(0,o.Uk)("Deschide");function c(e,a,l,c,m,p){const g=(0,o.up)("q-icon"),v=(0,o.up)("q-input"),f=(0,o.up)("q-tooltip"),w=(0,o.up)("q-btn"),b=(0,o.up)("q-td"),h=(0,o.up)("q-img"),U=(0,o.up)("q-avatar"),_=(0,o.up)("q-table"),H=(0,o.up)("User"),k=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(k,{class:"flex flex-block"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{class:"full-width sticky-header-table",flat:!0,title:"Useri",rows:e.rows,columns:e.columns,"row-key":"id",pagination:e.pagination,"onUpdate:pagination":a[2]||(a[2]=a=>e.pagination=a),loading:e.loading,filter:e.filter,"binary-state-sort":"","no-data-label":"Nu sunt înregistrări","rows-per-page-label":"Înregistrări pe pagină","rows-per-page-options":[30,50,100,200,500,1e3,0],onRequest:e.onRequest},{"top-right":(0,o.w5)((()=>[(0,o.Wm)(v,{outlined:"","bg-color":"white",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":a[0]||(a[0]=a=>e.filter=a),onKeyup:(0,t.D2)(e.onRequest,["enter"]),placeholder:"Caută"},{append:(0,o.w5)((()=>[(0,o.Wm)(g,{name:"search"})])),_:1},8,["modelValue","onKeyup"]),(0,o.Wm)(w,{icon:"search",round:"",onClick:e.onRequestWithLast,class:"q-ml-lg",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[s])),_:1})])),_:1},8,["onClick"]),(0,o.Wm)(w,{icon:"add",round:"",onClick:a[1]||(a[1]=a=>e.showUserModalSetValue(!0)),class:"q-ml-lg",color:"positive"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[n])),_:1})])),_:1})])),"body-cell-actions":(0,o.w5)((a=>[(0,o.Wm)(b,{props:a,class:"actions-td"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{dense:"",round:"",flat:"",size:"sm",color:"positive",onClick:l=>e.editRow(a),icon:"edit"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[i])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(w,{dense:"",round:"",flat:"",size:"sm",color:"negative",onClick:l=>e.deleteRow(a),icon:"delete"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[u])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),"body-cell-logo":(0,o.w5)((a=>[(0,o.Wm)(b,{props:a,class:"props-td"},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{onClick:l=>e.editRow(a),class:"cursor-pointer",style:{border:"1px solid #dddddd"}},{default:(0,o.w5)((()=>[e.getAvatar(a.row.avatar)?((0,o.wg)(),(0,o.j4)(h,{key:0,src:e.getAvatar(a.row.avatar),alt:""},null,8,["src"])):((0,o.wg)(),(0,o.iD)("div",{key:1,style:(0,r.j5)(`color: ${e.getColorForLogo(a.row.name)}`)},(0,r.zw)(e.getInitialsForLogo(a.row.name)),5)),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[d])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","pagination","loading","filter","onRequest"]),(0,o.Wm)(H,{ref:"UserRef",onOnCloseDialog:a[3]||(a[3]=a=>e.showUserModalSetValue(!1))},null,512)])),_:1})}l(5363);var m=l(1959),p=l(3617),g=l(5474),v=l(3413);const f={class:"text-subtitle1"},w=(0,o._)("span",{class:"text-blue-grey"},"User",-1),b={class:(0,r.C_)("q-ml-md")};function h(e,a,l,t,s,n){const i=(0,o.up)("q-toolbar-title"),u=(0,o.up)("header-tabs-for-forms"),d=(0,o.up)("q-space"),c=(0,o.up)("q-btn"),m=(0,o.up)("q-toolbar"),p=(0,o.up)("q-separator"),g=(0,o.up)("UserGeneral"),v=(0,o.up)("q-tab-panel"),h=(0,o.up)("q-tab-panels"),U=(0,o.up)("q-card-section"),_=(0,o.up)("q-card-actions"),H=(0,o.up)("q-card"),k=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(k,{ref:"dialogRef",modelValue:t.isOpenedLocal,"onUpdate:modelValue":a[2]||(a[2]=e=>t.isOpenedLocal=e),onHide:t.onDialogHide,"full-height":"",persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(H,{class:"q-dialog-plugin",style:{width:"100%","max-width":"1300px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:(0,r.C_)("q-pr-xs")},{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o._)("span",f,[w,(0,o._)("strong",b,(0,r.zw)(t.id),1)])])),_:1}),(0,o.Wm)(u,{modelValue:t.tab,"onUpdate:modelValue":a[0]||(a[0]=e=>t.tab=e),tabs:t.tabs},null,8,["modelValue","tabs"]),(0,o.Wm)(d),(0,o.Wm)(c,{icon:"close",flat:"",round:"",dense:"",onClick:t.onCancelClick},null,8,["onClick"])])),_:1}),(0,o.Wm)(p),(0,o.Wm)(U,{style:{"min-height":"calc(100vh - 165px)","max-height":"calc(100vh - 165px)"},class:"scroll"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{modelValue:t.tab,"onUpdate:modelValue":a[1]||(a[1]=e=>t.tab=e),animated:"","keep-alive":""},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{name:"general",class:"q-pa-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{ref:"UserGeneralRef"},null,512)])),_:1})])),_:1},8,["modelValue"])])),_:1}),"general"===t.tab?((0,o.wg)(),(0,o.j4)(p,{key:0})):(0,o.kq)("",!0),"general"===t.tab?((0,o.wg)(),(0,o.j4)(_,{key:1,align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{color:"primary",label:"Salvează",onClick:t.onOKClick},null,8,["onClick"]),(0,o.Wm)(c,{label:"Închide",onClick:t.onCancelClick},null,8,["onClick"])])),_:1})):(0,o.kq)("",!0)])),_:1})])),_:1},8,["modelValue","onHide"])}l(71);var U=l(1701),_=l(7755);const H={class:"row"},k={class:"col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12 q-pa-xs"},q={class:"col-xl-9 col-lg-9 col-md-9 col-sm-12 col-xs-12 row"},C={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},Z={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},R={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},x={class:"col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-12 q-pa-xs"},W={class:"col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12 q-pa-xs"};function y(e,a,l,t,r,s){const n=(0,o.up)("avatar-upload-field"),i=(0,o.up)("q-input"),u=(0,o.up)("q-select");return(0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("div",k,[(0,o.Wm)(n,{linkToCurrentImage:e.avatar,isFor:"user",id:e.id},null,8,["linkToCurrentImage","id"])]),(0,o._)("div",q,[(0,o._)("div",C,[(0,o.Wm)(i,{outlined:"",error:e.nameHasError,onBlur:a[0]||(a[0]=a=>e.nameHasError=!1),onFocus:a[1]||(a[1]=a=>e.nameHasError=!1),modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=a=>e.name=a),label:"Nume Prenume"},null,8,["error","modelValue"])]),(0,o._)("div",Z,[(0,o.Wm)(i,{outlined:"",error:e.phone1HasError,onBlur:a[3]||(a[3]=a=>e.phone1HasError=!1),onFocus:a[4]||(a[4]=a=>e.phone1HasError=!1),modelValue:e.phone1,"onUpdate:modelValue":a[5]||(a[5]=a=>e.phone1=a),label:"Telefon 1"},null,8,["error","modelValue"])]),(0,o._)("div",R,[(0,o.Wm)(i,{outlined:"",error:e.emailHasError,onBlur:a[6]||(a[6]=a=>e.emailHasError=!1),onFocus:a[7]||(a[7]=a=>e.emailHasError=!1),modelValue:e.email,"onUpdate:modelValue":a[8]||(a[8]=a=>e.email=a),label:"Login/email"},null,8,["error","modelValue"])]),(0,o._)("div",x,[(0,o.Wm)(i,{outlined:"",rules:e.passwordRule,error:e.passwordHasError,onBlur:a[9]||(a[9]=a=>e.passwordHasError=!1),onFocus:a[10]||(a[10]=a=>e.passwordHasError=!1),modelValue:e.password,"onUpdate:modelValue":a[11]||(a[11]=a=>e.password=a),label:"Parola"},null,8,["rules","error","modelValue"])])]),(0,o._)("div",W,[(0,o.Wm)(u,{outlined:"",modelValue:e.roleId,"onUpdate:modelValue":a[12]||(a[12]=a=>e.roleId=a),options:e.roleOptions,"emit-value":"","map-options":"","option-value":"value","option-label":"label",label:"Rol"},null,8,["modelValue","options"])])])}l(246);var V=l(9517),E=l(27);const O=(0,o.aZ)({name:"UserGeneral",components:{AvatarUploadField:V.Z},setup(){const e=(0,p.oR)(),a=(0,m.iH)(""),l=(0,m.iH)(!1),t=(0,m.iH)(!1),r=(0,m.iH)(!1),s=(0,m.iH)(""),n=(0,m.iH)(!1),i=(0,m.iH)(""),u=(0,m.iH)(!1),d=(0,m.iH)(""),c=(0,m.iH)(""),f=(0,m.iH)(""),w=(0,m.iH)(!1),b=(0,m.iH)(0),h=(0,m.iH)({}),U=(0,m.iH)(""),_=(0,m.iH)([]),H=(0,m.iH)([]);Object.keys(E.Z.USER_ROLES).forEach((e=>{_.value.push({label:E.Z.USER_ROLES[e],value:String(e)})})),(0,o.m0)((()=>{h.value=e.getters["users/getOpenedUserData"]})),(0,o.m0)((()=>{i.value.length>0?H.value=[e=>e.length>=8||"Minimum 8 caractere"]:H.value=[]})),(0,o.m0)((()=>{b.value=h.value.id||0,a.value=h.value.name||"",U.value=h.value.avatar||"",s.value=h.value.phone1||"",i.value=h.value.password||"",d.value=h.value.email||"",f.value=h.value.description||"",c.value=h.value.role_id?String(h.value.role_id):"2"}));const k=()=>{if(a.value||(l.value=!0),s.value||(n.value=!0),u.value=!b.value&&i.value.length<8,!l.value&&!t.value&&!r.value&&!n.value&&!u.value){const l={name:a.value,phone1:s.value,password:i.value,email:d.value,description:f.value,role_id:c.value};(0,v.QP)();const o=parseInt(String(b.value),10);g.api.post(`/user-add-or-edit/${o}`,l).then((a=>{(0,v.Zk)(),a.data.success?(o>0?(e.commit("users/updateOpenedUserData",{}),e.commit("users/updateOpenedUserForm",!1)):(e.commit("users/updateOpenedUserData",a.data.data),e.commit("users/updateOpenedUserForm",!0)),e.commit("users/updateRefreshGrid",!0),H.value=[]):(0,v.NU)({message:"Eroare de update"})})).catch((e=>{(0,v.Zk)(),(0,v.NU)({},e)}))}};return{id:b,name:a,avatar:U,nameHasError:l,phone1:s,phone1HasError:n,password:i,passwordHasError:u,email:d,emailHasError:w,roleId:c,roleOptions:_,save:k,passwordRule:H}}});var Q=l(4260),D=l(4842),S=l(8516),L=l(7518),F=l.n(L);const I=(0,Q.Z)(O,[["render",y]]),T=I;F()(O,"components",{QInput:D.Z,QSelect:S.Z});const P={name:"User",components:{UserGeneral:T,HeaderTabsForForms:_.Z},props:{},emits:[...U.Z.emits,"onCloseDialog"],setup(e,a){const l=(0,m.iH)(!1),t=(0,m.iH)(null),r=(0,m.iH)([{name:"general",icon:"store",label:"Date generale"},{name:"bids",icon:"warning_amber",label:"Cereri"},{name:"contracte",icon:"gavel",label:"Contracte"},{name:"payments",icon:"payments",label:"Plăți"},{name:"files",icon:"folder_open",label:"Fișiere"},{name:"logs",icon:"history",label:"Log"}]),s=(0,m.iH)("general"),n=(0,m.iH)(0),i=(0,p.oR)(),u=(0,m.iH)({}),{dialogRef:d,onDialogHide:c,onDialogCancel:f}=(0,U.Z)();(0,o.m0)((()=>{l.value=i.getters["users/getOpenedUserForm"]})),(0,o.m0)((()=>{u.value=i.getters["users/getOpenedUserData"]})),(0,o.m0)((()=>{n.value=u.value.id}));const w=(e=null)=>{const a={...i.getters["users/getOpenedUserData"]};a.id=e,i.commit("users/updateOpenedUserData",a),(0,v.QP)(),g.api.get(`/users/get-data-by-id/${e}`).then((e=>{(0,v.Zk)(),e.data.success?i.commit("users/updateOpenedUserData",e.data.data):(0,v.NU)({message:e.data.data.message})})).catch((e=>{(0,v.Zk)(),(0,v.NU)({},e)}))},b=()=>{a.emit("onCloseDialog",!1),c()},h=()=>{"undefined"!==typeof t.value&&"undefined"!==typeof t.value.save&&t.value.save()};return{dialogRef:d,onDialogHide:b,onOKClick:h,onCancelClick:f,isOpenedLocal:l,id:n,tab:s,tabs:r,UserGeneralRef:t,getDataById:w}}};var A=l(6778),B=l(151),N=l(9570),G=l(3747),j=l(2025),z=l(2165),$=l(5869),M=l(5589),K=l(5906),J=l(6602),X=l(9367);const Y=(0,Q.Z)(P,[["render",h]]),ee=Y;F()(P,"components",{QDialog:A.Z,QCard:B.Z,QToolbar:N.Z,QToolbarTitle:G.Z,QSpace:j.Z,QBtn:z.Z,QSeparator:$.Z,QCardSection:M.Z,QTabPanels:K.Z,QTabPanel:J.Z,QCardActions:X.Z});var ae=l(8825);const le=[{name:"id",label:"ID",field:"id",sortable:!0,style:"width: 50px"},{name:"logo",label:"",align:"center",style:"width: 80px"},{name:"name",label:"Nume",field:"name",sortable:!0,align:"left"},{name:"role_id",label:"Rol",field:"role_id",sortable:!0,align:"left",format:e=>e&&E.Z.USER_ROLES[parseInt(e,10)]?E.Z.USER_ROLES[parseInt(e,10)]:E.Z.USER_ROLES[1]},{name:"phone1",label:"Telefon",field:"phone1",sortable:!0,align:"left"},{name:"email",label:"Email",field:"email",sortable:!0,align:"left"},{name:"created_at2",label:"Adăugat",field:"created_at2",sortable:!0},{name:"actions",label:"",align:"center",style:"width: 60px"}],oe=(0,o.aZ)({name:"users",components:{User:ee},setup(){const e=(0,ae.Z)(),a=(0,m.iH)([]),l=(0,m.iH)(null),t=(0,m.iH)(""),r=(0,m.iH)(!1),s=(0,p.oR)(),n=(0,m.iH)(null);s.commit("auth/updateActiveModule","Users");const i=(0,m.iH)({sortBy:"id",descending:!0,page:1,rowsPerPage:30}),u=e=>{if(e){const a=(0,v.LO)(e),l=String(g.api.defaults.baseURL);return`${l.replace("/api","")}/${a}`}return""},d=e=>(0,v.Qm)(e),c=e=>(0,v.Zx)(e),f=e=>{r.value=!0,n.value=e,s.commit("users/updateRefreshGrid",!1),g.api.post("/users-list",{...e}).then((e=>{r.value=!1,e.data.success&&(a.value=e.data.data.data,i.value.page=e.data.data.current_page,i.value.rowsPerPage=e.data.data.per_page,i.value.rowsNumber=e.data.data.total)})).catch((e=>{r.value=!1,(0,v.NU)({},e)}))},w=(e,a=0)=>{s.commit("users/updateOpenedUserForm",e),s.commit("users/updateOpenedUserData",{}),e&&a>0&&l.value&&l.value.getDataById(a)},b=e=>{w(!0,e.row.id)},h=a=>{e.dialog({title:"Atenție",message:"Sunteți sigur că doriți să ștergeți?",cancel:!0,persistent:!0}).onOk((()=>{g.api["delete"](`/users/${a.row.id}`).then((()=>{f(n.value)}))}))},U=()=>{f(n.value)};return(0,o.m0)((()=>{s.getters["users/getRefreshGrid"]&&f(n.value)})),(0,o.bv)((()=>{f({pagination:i.value,filter:void 0})})),{filter:t,loading:r,pagination:i,columns:le,rows:a,showUserModalSetValue:w,editRow:b,deleteRow:h,onRequest:f,UserRef:l,getAvatar:u,getColorForLogo:c,getInitialsForLogo:d,onRequestWithLast:U}}});var te=l(4379),re=l(8107),se=l(4554),ne=l(8870),ie=l(3884),ue=l(5096),de=l(4027);const ce=(0,Q.Z)(oe,[["render",c]]),me=ce;F()(oe,"components",{QPage:te.Z,QTable:re.Z,QInput:D.Z,QIcon:se.Z,QBtn:z.Z,QTooltip:ne.Z,QTd:ie.Z,QAvatar:ue.Z,QImg:de.Z})}}]);